<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!-- NewPage -->
<html lang="en">
<head>
	<!-- Generated by javadoc (version 1.7.0-google-v6) on Tue Apr 28 16:33:17 EDT 2015 -->
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<title>SingletonScope (Google Guice - Core Library 4.0 API)</title>
	<meta name="date" content="2015-04-28">
	<link rel="stylesheet" type="text/css" href="../../../../stylesheet.css" title="Style">
</head>
<body>
<script type="text/javascript"><!--
if (location.href.indexOf('is-external=true') == -1) {
	parent.document.title = "SingletonScope (Google Guice - Core Library 4.0 API)";
}
//-->
</script>
<noscript>
	<div>JavaScript is disabled on your browser.</div>
</noscript>
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="topNav"><a name="navbar_top">
	<!--   -->
</a><a href="#skip-navbar_top" title="Skip navigation links"></a><a name="navbar_top_firstrow">
	<!--   -->
</a>
	<ul class="navList" title="Navigation">
		<li><a href="../../../../overview-summary.html">Overview</a></li>
		<li><a href="package-summary.html">Package</a></li>
		<li class="navBarCell1Rev">Class</li>
		<li><a href="class-use/SingletonScope.html">Use</a></li>
		<li><a href="package-tree.html">Tree</a></li>
		<li><a href="../../../../deprecated-list.html">Deprecated</a></li>
		<li><a href="../../../../index-all.html">Index</a></li>
		<li><a href="../../../../help-doc.html">Help</a></li>
	</ul>
</div>
<div class="subNav">
	<ul class="navList">
		<li><a href="../../../../com/google/inject/internal/Scoping.html"
		       title="class in com.google.inject.internal"><span class="strong">Prev Class</span></a></li>
		<li><a href="../../../../com/google/inject/internal/UniqueAnnotations.html"
		       title="class in com.google.inject.internal"><span class="strong">Next Class</span></a></li>
	</ul>
	<ul class="navList">
		<li><a href="../../../../index.html?com/google/inject/internal/SingletonScope.html" target="_top">Frames</a>
		</li>
		<li><a href="SingletonScope.html" target="_top">No Frames</a></li>
	</ul>
	<ul class="navList" id="allclasses_navbar_top">
		<li><a href="../../../../allclasses-noframe.html">All Classes</a></li>
	</ul>
	<div>
		<script type="text/javascript"><!--
		allClassesLink = document.getElementById("allclasses_navbar_top");
		if (window == top) {
			allClassesLink.style.display = "block";
		}
		else {
			allClassesLink.style.display = "none";
		}
		//-->
		</script>
	</div>
	<div>
		<ul class="subNavList">
			<li>Summary:&nbsp;</li>
			<li>Nested&nbsp;|&nbsp;</li>
			<li>Field&nbsp;|&nbsp;</li>
			<li><a href="#constructor_summary">Constr</a>&nbsp;|&nbsp;</li>
			<li><a href="#method_summary">Method</a></li>
		</ul>
		<ul class="subNavList">
			<li>Detail:&nbsp;</li>
			<li>Field&nbsp;|&nbsp;</li>
			<li><a href="#constructor_detail">Constr</a>&nbsp;|&nbsp;</li>
			<li><a href="#method_detail">Method</a></li>
		</ul>
	</div>
	<a name="skip-navbar_top">
		<!--   -->
	</a></div>
<!-- ========= END OF TOP NAVBAR ========= -->
<!-- ======== START OF CLASS DATA ======== -->
<div class="header">
	<div class="subTitle">com.google.inject.internal</div>
	<h2 title="Class SingletonScope" class="title">Class SingletonScope</h2>
</div>
<div class="contentContainer">
	<ul class="inheritance">
		<li><a href="http://java.sun.com/javase/6/docs/api/java/lang/Object.html?is-external=true"
		       title="class or interface in java.lang">java.lang.Object</a></li>
		<li>
			<ul class="inheritance">
				<li>com.google.inject.internal.SingletonScope</li>
			</ul>
		</li>
	</ul>
	<div class="description">
		<ul class="blockList">
			<li class="blockList">
				<dl>
					<dt>All Implemented Interfaces:</dt>
					<dd><a href="../../../../com/google/inject/Scope.html"
					       title="interface in com.google.inject">Scope</a></dd>
				</dl>
				<hr>
				<br>
<pre>public class <span class="strong">SingletonScope</span>
extends <a href="http://java.sun.com/javase/6/docs/api/java/lang/Object.html?is-external=true"
           title="class or interface in java.lang">Object</a>
implements <a href="../../../../com/google/inject/Scope.html" title="interface in com.google.inject">Scope</a></pre>
				<div class="block">One instance per <a href="../../../../com/google/inject/Injector.html"
				                                       title="interface in com.google.inject"><code>Injector</code></a>.
					Also see <code>@</code><a href="../../../../com/google/inject/Singleton.html"
					                          title="annotation in com.google.inject"><code>Singleton</code></a>.

					Introduction from the author:
					Implementation of this class seems unreasonably complicated at the first sight.
					I fully agree with you, that the beast below is very complex
					and it's hard to reason on how does it work or not.
					Still I want to assure you that hundreds(?) of hours were thrown
					into making this code simple, while still maintaining Singleton contract.

					Anyway, why is it so complex? Singleton scope does not seem to be that unique.
					1) Guice has never truly expected to be used in multi threading environment
					with many Injectors working alongside each other. There is almost no
					code with Guice that propagates state between threads. And Singleton
					scope is The exception.
					2) Guice supports circular dependencies and thus manages proxy objects.
					There is no interface that allows user defined Scopes to create proxies,
					it is expected to be done by Guice. Singleton scope needs to be
					able to detect circular dependencies spanning several threads,
					therefore Singleton scope needs to be able to create these proxies.
					3) To make things worse, Guice has a very tricky definition for a binding
					resolution when Injectors are in in a parent/child relationship.
					And Scope does not have access to this information by design,
					the only real action that Scope can do is to call or not to call a creator.
					4) There is no readily available code in Guice that can detect a potential
					deadlock, and no code for handling dependency cycles spanning several threads.
					This is significantly harder as all the dependencies in a thread at runtime
					can be represented with a list, where in a multi threaded environment
					we have more complex dependency trees.
					5) Guice has a pretty strong contract regarding Garbage Collection,
					which often prevents us from linking objects directly.
					So simple domain specific code can not be written and intermediary
					id objects need to be managed.
					6) Guice is relatively fast and we should not make things worse.
					We're trying our best to optimize synchronization for speed and memory.
					Happy path should be almost as fast as in a single threaded solution
					and should not take much more memory.
					7) Error message generation in Guice was not meant to be used like this and to work around
					its APIs we need a lot of code. Additional complexity comes from inherent data races
					as message is only generated when failure occurs on proxy object generation.
					Things get ugly pretty fast.
				</div>
				<dl>
					<dt><span class="strong">Author:</span></dt>
					<dd>timofeyb (Timothy Basanov)</dd>
					<dt><span class="strong">See Also:</span></dt>
					<dd>
						<a href="../../../../com/google/inject/internal/SingletonScope.html#scope(com.google.inject.Key,%20com.google.inject.Provider)"><code>scope(Key,
							Provider)</code></a>,
						<code>CycleDetectingLock</code></dd>
				</dl>
			</li>
		</ul>
	</div>
	<div class="summary">
		<ul class="blockList">
			<li class="blockList">
				<!-- ======== CONSTRUCTOR SUMMARY ======== -->
				<ul class="blockList">
					<li class="blockList"><a name="constructor_summary">
						<!--   -->
					</a>
						<h3>Constructor Summary</h3>
						<table class="overviewSummary" border="0" cellpadding="3" cellspacing="0"
						       summary="Constructor Summary table, listing constructors, and an explanation">
							<caption><span>Constructors</span><span class="tabEnd">&nbsp;</span></caption>
							<tr>
								<th class="colOne" scope="col">Constructor and Description</th>
							</tr>
							<tr class="altColor">
								<td class="colOne"><code><strong><a
										href="../../../../com/google/inject/internal/SingletonScope.html#SingletonScope()">SingletonScope</a></strong>()</code>&nbsp;
								</td>
							</tr>
						</table>
					</li>
				</ul>
				<!-- ========== METHOD SUMMARY =========== -->
				<ul class="blockList">
					<li class="blockList"><a name="method_summary">
						<!--   -->
					</a>
						<h3>Method Summary</h3>
						<table class="overviewSummary" border="0" cellpadding="3" cellspacing="0"
						       summary="Method Summary table, listing methods, and an explanation">
							<caption><span>Methods</span><span class="tabEnd">&nbsp;</span></caption>
							<tr>
								<th class="colFirst" scope="col">Modifier and Type</th>
								<th class="colLast" scope="col">Method and Description</th>
							</tr>
							<tr class="altColor">
								<td class="colFirst"><code>&lt;T&gt;&nbsp;<a
										href="../../../../com/google/inject/Provider.html"
										title="interface in com.google.inject">Provider</a>&lt;T&gt;</code></td>
								<td class="colLast"><code><strong><a
										href="../../../../com/google/inject/internal/SingletonScope.html#scope(com.google.inject.Key,%20com.google.inject.Provider)">scope</a></strong>(<a
										href="../../../../com/google/inject/Key.html"
										title="class in com.google.inject">Key</a>&lt;T&gt;&nbsp;key,
									<a href="../../../../com/google/inject/Provider.html"
									   title="interface in com.google.inject">Provider</a>&lt;T&gt;&nbsp;creator)</code>
									<div class="block">Provides singleton scope with the following properties:
										- creates no more than one instance per Key as a creator is used no more than
										once,
										- result is cached and returned quickly on subsequent calls,
										- exception in a creator is not treated as instance creation and is not cached,
										- creates singletons in parallel whenever possible,
										- waits for dependent singletons to be created even across threads and when
										dependencies
										are shared as long as no circular dependencies are detected,
										- returns circular proxy only when circular dependencies are detected,
										- aside from that, blocking synchronization is only used for proxy creation and
										initialization,
									</div>
								</td>
							</tr>
							<tr class="rowColor">
								<td class="colFirst"><code><a
										href="http://java.sun.com/javase/6/docs/api/java/lang/String.html?is-external=true"
										title="class or interface in java.lang">String</a></code></td>
								<td class="colLast"><code><strong><a
										href="../../../../com/google/inject/internal/SingletonScope.html#toString()">toString</a></strong>()</code>
									<div class="block">A short but useful description of this scope.</div>
								</td>
							</tr>
						</table>
						<ul class="blockList">
							<li class="blockList"><a name="methods_inherited_from_class_java.lang.Object">
								<!--   -->
							</a>
								<h3>Methods inherited from class&nbsp;java.lang.<a
										href="http://java.sun.com/javase/6/docs/api/java/lang/Object.html?is-external=true"
										title="class or interface in java.lang">Object</a></h3>
								<code><a
										href="http://java.sun.com/javase/6/docs/api/java/lang/Object.html?is-external=true#clone()"
										title="class or interface in java.lang">clone</a>, <a
										href="http://java.sun.com/javase/6/docs/api/java/lang/Object.html?is-external=true#equals(java.lang.Object)"
										title="class or interface in java.lang">equals</a>, <a
										href="http://java.sun.com/javase/6/docs/api/java/lang/Object.html?is-external=true#finalize()"
										title="class or interface in java.lang">finalize</a>, <a
										href="http://java.sun.com/javase/6/docs/api/java/lang/Object.html?is-external=true#getClass()"
										title="class or interface in java.lang">getClass</a>, <a
										href="http://java.sun.com/javase/6/docs/api/java/lang/Object.html?is-external=true#hashCode()"
										title="class or interface in java.lang">hashCode</a>, <a
										href="http://java.sun.com/javase/6/docs/api/java/lang/Object.html?is-external=true#notify()"
										title="class or interface in java.lang">notify</a>, <a
										href="http://java.sun.com/javase/6/docs/api/java/lang/Object.html?is-external=true#notifyAll()"
										title="class or interface in java.lang">notifyAll</a>, <a
										href="http://java.sun.com/javase/6/docs/api/java/lang/Object.html?is-external=true#wait()"
										title="class or interface in java.lang">wait</a>, <a
										href="http://java.sun.com/javase/6/docs/api/java/lang/Object.html?is-external=true#wait(long)"
										title="class or interface in java.lang">wait</a>, <a
										href="http://java.sun.com/javase/6/docs/api/java/lang/Object.html?is-external=true#wait(long,%20int)"
										title="class or interface in java.lang">wait</a></code></li>
						</ul>
					</li>
				</ul>
			</li>
		</ul>
	</div>
	<div class="details">
		<ul class="blockList">
			<li class="blockList">
				<!-- ========= CONSTRUCTOR DETAIL ======== -->
				<ul class="blockList">
					<li class="blockList"><a name="constructor_detail">
						<!--   -->
					</a>
						<h3>Constructor Detail</h3>
						<a name="SingletonScope()">
							<!--   -->
						</a>
						<ul class="blockListLast">
							<li class="blockList">
								<h4>SingletonScope</h4>
								<pre>public&nbsp;SingletonScope()</pre>
							</li>
						</ul>
					</li>
				</ul>
				<!-- ============ METHOD DETAIL ========== -->
				<ul class="blockList">
					<li class="blockList"><a name="method_detail">
						<!--   -->
					</a>
						<h3>Method Detail</h3>
						<a name="scope(com.google.inject.Key, com.google.inject.Provider)">
							<!--   -->
						</a>
						<ul class="blockList">
							<li class="blockList">
								<h4>scope</h4>
<pre>public&nbsp;&lt;T&gt;&nbsp;<a href="../../../../com/google/inject/Provider.html"
                                   title="interface in com.google.inject">Provider</a>&lt;T&gt;&nbsp;scope(<a
		href="../../../../com/google/inject/Key.html" title="class in com.google.inject">Key</a>&lt;T&gt;&nbsp;key,
                    <a href="../../../../com/google/inject/Provider.html" title="interface in com.google.inject">Provider</a>&lt;T&gt;&nbsp;creator)</pre>
								<div class="block">Provides singleton scope with the following properties:
									- creates no more than one instance per Key as a creator is used no more than once,
									- result is cached and returned quickly on subsequent calls,
									- exception in a creator is not treated as instance creation and is not cached,
									- creates singletons in parallel whenever possible,
									- waits for dependent singletons to be created even across threads and when
									dependencies
									are shared as long as no circular dependencies are detected,
									- returns circular proxy only when circular dependencies are detected,
									- aside from that, blocking synchronization is only used for proxy creation and
									initialization,
								</div>
								<dl>
									<dt><strong>Specified by:</strong></dt>
									<dd><code><a
											href="../../../../com/google/inject/Scope.html#scope(com.google.inject.Key,%20com.google.inject.Provider)">scope</a></code>&nbsp;in
										interface&nbsp;<code><a href="../../../../com/google/inject/Scope.html"
										                        title="interface in com.google.inject">Scope</a></code>
									</dd>
									<dt><span class="strong">Parameters:</span></dt>
									<dd><code>key</code> - binding key</dd>
									<dd><code>creator</code> - locates an instance when one doesn't already exist in
										this
										scope.
									</dd>
									<dt><span class="strong">Returns:</span></dt>
									<dd>a new provider which only delegates to the given unscoped provider
										when an instance of the requested object doesn't already exist in this
										scope
									</dd>
									<dt><span class="strong">See Also:</span></dt>
									<dd>
										<a href="../../../../com/google/inject/internal/CycleDetectingLock.CycleDetectingLockFactory.html"
										   title="class in com.google.inject.internal"><code>CycleDetectingLock.CycleDetectingLockFactory</code></a>
									</dd>
								</dl>
							</li>
						</ul>
						<a name="toString()">
							<!--   -->
						</a>
						<ul class="blockListLast">
							<li class="blockList">
								<h4>toString</h4>
								<pre>public&nbsp;<a
										href="http://java.sun.com/javase/6/docs/api/java/lang/String.html?is-external=true"
										title="class or interface in java.lang">String</a>&nbsp;toString()</pre>
								<div class="block"><strong>Description copied from interface:&nbsp;<code><a
										href="../../../../com/google/inject/Scope.html#toString()">Scope</a></code></strong>
								</div>
								<div class="block">A short but useful description of this scope. For comparison, the
									standard
									scopes that ship with guice use the descriptions
									<code>"Scopes.SINGLETON"</code>, <code>"ServletScopes.SESSION"</code> and
									<code>"ServletScopes.REQUEST"</code>.
								</div>
								<dl>
									<dt><strong>Specified by:</strong></dt>
									<dd><code><a href="../../../../com/google/inject/Scope.html#toString()">toString</a></code>&nbsp;in
										interface&nbsp;<code><a href="../../../../com/google/inject/Scope.html"
										                        title="interface in com.google.inject">Scope</a></code>
									</dd>
									<dt><strong>Overrides:</strong></dt>
									<dd><code><a
											href="http://java.sun.com/javase/6/docs/api/java/lang/Object.html?is-external=true#toString()"
											title="class or interface in java.lang">toString</a></code>&nbsp;in class&nbsp;<code><a
											href="http://java.sun.com/javase/6/docs/api/java/lang/Object.html?is-external=true"
											title="class or interface in java.lang">Object</a></code></dd>
								</dl>
							</li>
						</ul>
					</li>
				</ul>
			</li>
		</ul>
	</div>
</div>
<!-- ========= END OF CLASS DATA ========= -->
<!-- ======= START OF BOTTOM NAVBAR ====== -->
<div class="bottomNav"><a name="navbar_bottom">
	<!--   -->
</a><a href="#skip-navbar_bottom" title="Skip navigation links"></a><a name="navbar_bottom_firstrow">
	<!--   -->
</a>
	<ul class="navList" title="Navigation">
		<li><a href="../../../../overview-summary.html">Overview</a></li>
		<li><a href="package-summary.html">Package</a></li>
		<li class="navBarCell1Rev">Class</li>
		<li><a href="class-use/SingletonScope.html">Use</a></li>
		<li><a href="package-tree.html">Tree</a></li>
		<li><a href="../../../../deprecated-list.html">Deprecated</a></li>
		<li><a href="../../../../index-all.html">Index</a></li>
		<li><a href="../../../../help-doc.html">Help</a></li>
	</ul>
</div>
<div class="subNav">
	<ul class="navList">
		<li><a href="../../../../com/google/inject/internal/Scoping.html"
		       title="class in com.google.inject.internal"><span class="strong">Prev Class</span></a></li>
		<li><a href="../../../../com/google/inject/internal/UniqueAnnotations.html"
		       title="class in com.google.inject.internal"><span class="strong">Next Class</span></a></li>
	</ul>
	<ul class="navList">
		<li><a href="../../../../index.html?com/google/inject/internal/SingletonScope.html" target="_top">Frames</a>
		</li>
		<li><a href="SingletonScope.html" target="_top">No Frames</a></li>
	</ul>
	<ul class="navList" id="allclasses_navbar_bottom">
		<li><a href="../../../../allclasses-noframe.html">All Classes</a></li>
	</ul>
	<div>
		<script type="text/javascript"><!--
		allClassesLink = document.getElementById("allclasses_navbar_bottom");
		if (window == top) {
			allClassesLink.style.display = "block";
		}
		else {
			allClassesLink.style.display = "none";
		}
		//-->
		</script>
	</div>
	<div>
		<ul class="subNavList">
			<li>Summary:&nbsp;</li>
			<li>Nested&nbsp;|&nbsp;</li>
			<li>Field&nbsp;|&nbsp;</li>
			<li><a href="#constructor_summary">Constr</a>&nbsp;|&nbsp;</li>
			<li><a href="#method_summary">Method</a></li>
		</ul>
		<ul class="subNavList">
			<li>Detail:&nbsp;</li>
			<li>Field&nbsp;|&nbsp;</li>
			<li><a href="#constructor_detail">Constr</a>&nbsp;|&nbsp;</li>
			<li><a href="#method_detail">Method</a></li>
		</ul>
	</div>
	<a name="skip-navbar_bottom">
		<!--   -->
	</a></div>
<!-- ======== END OF BOTTOM NAVBAR ======= -->
<p class="legalCopy">
	<small>Copyright &#169; 2006-2015 <a href="http://www.google.com">Google, Inc.</a>. All Rights Reserved.</small>
</p>
</body>
</html>
